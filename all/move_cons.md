

# move 생성자, move 대입 연산자    
## [왜 필요한가](https://www.educative.io/edpresso/what-is-a-move-constructor-in-cpp)  

## 키워드  
1. **임시 객체** : expression 종료 시 사라지는 객체  
2. **불필요한 메모리 복사** : 이동 생성자를 통해 피하고자 하는 것.  
3. **이동 생성자** : 복사 생성자를 통해 메모리를 카피하는 것이 아닌, 메모리 주소를 `뺏어 온다.`  
4. **rvalue 참조자** : && ampersand 두개를 사용하며, 임시 객체를 참조할 수 있는 참조자  


## 1. 필요성  

#### 1.1. move 생성자, 대입 연산자가 없다면...  
* rvalue인 **임시 객체**를 바탕으로 새로운 객체를 생성할 때 **과도한 메모리 복사**가 발생한다.  
* 이는 **복사 생성자**가 호출되어, 복사 생성자 내에 구현된 **메모리 복사**로 인해 발생하는 것이다.  
```c++
vector<User> vc;
vc.push_back(User()); // User() 는 rvalue인 임시 객체이다.
```

```c++
1. 기본 생성자 호출 - 임시 객체 생성
2. 복사 생성자 호출 - 임시 객체를 바탕으로 새로운 객체 생성 >> 이 과정에서 메모리 카피 발생
```

#### 1.2. 그냥 임시 객체의 값을 "뺏어오면" 안될까?  
* 생성자의 `매개변수 타입`을 **rvalue reference**로 정의한 생성자를 **이동 생성자**라고 한다.  
```c++
// 이동 생성자
User(User&& tmp){
  mPtr = tmp.mPtr;
  tmp.mPtr = nullptr;
}
```
* 이를 통해 임시 객체를 기반으로 생성자를 호출하거나, std::move()를 통해 rvalue로 캐스팅된 객체를 받게 되면 `이동 생성자`가 호출된다.  

#### 1.3. 이동 생성자 호출  
```c++
vector<User> vc;
vc.push_back(User()); // User() 는 rvalue인 임시 객체이다.
```

```c++
1. 기본 생성자 호출 - 임시 객체 생성
2. 이동 생성자 호출 - 임시 객체의 멤버 필드가 가지고 있는 메모리 주소값을 자신이 가지고, 임시 객체는 null값을 가지게 한다.  
```
* 이를 통해 **불필요한 메모리 복사**를 방지하여 성능을 향상시킨다.  


## 2. vector::push_back()  
* c++ 11부터 push_back은 rvalue 참조자를 받을 수 있도록 오버로딩되어 있다.  
```c++
1. void push_back (const value_type& val);
2. void push_back (value_type&& val);
```

* push_back()에 임시객체를 넘기면 이동 생성자가 호출되어, 불필요한 메모리 복사를 방지한다.  
